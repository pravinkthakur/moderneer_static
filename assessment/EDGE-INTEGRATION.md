# Edge Assessment Integration

This document describes the integration between Edge-generated assessment.json files and the static assessment UI.

## Features

### 1. Upload Edge Assessment (üì•)

Click the **Upload button** (üì• icon) in the toolbar to load an assessment.json file generated by the Edge tool.

**What happens:**
- Opens a file picker to select your assessment.json file
- Parses the Edge format (v3.0.0) and validates the structure  
- Maps Edge parameter IDs and checks to the static UI structure
- Auto-populates all fields with:
  - Check boxes (based on score > 50)
  - Scale sliders (0-5 or 0-100)
  - Manual review flags (N/A checkboxes)
  - Evidence excerpts and answers

**Supported:**
- `check` type ‚Üí checkbox (score ‚â•50 = checked)
- `scale5` type ‚Üí 0-5 slider (score/100 * 5)
- `scale100` type ‚Üí 0-100 slider (score directly)
- `manual_review_required` ‚Üí N/A checkbox
- `evidence_excerpt` ‚Üí warning icon with tooltip
- `answer` ‚Üí stored as evidence if available

### 2. Evidence Tooltips (‚ö†Ô∏è)

When an assessment is loaded from Edge, checks that have evidence will show a **warning icon (‚ö†Ô∏è)** next to the label.

**How to use:**
- Hover over the ‚ö†Ô∏è icon to see the full evidence excerpt in a tooltip
- The tooltip shows the LLM's reasoning and evidence for that particular check
- Evidence helps you understand why Edge assigned that score
- You can modify the score and the evidence will remain visible

**Tooltip behavior:**
- Appears on mouse hover
- Positioned near the icon (adjusts if off-screen)
- Dark background with white text for readability
- Maximum width of 400px with text wrapping

### 3. Export to Edge Format (üì§)

Click the **Export button** (üì§ icon) to download your assessment in Edge-compatible JSON format.

**What's exported:**
- Full Edge v3.0.0 schema structure
- All pillars, parameters, and checks
- Your current scores and selections from the UI
- Evidence excerpts (preserved from upload or empty)
- Answers field (preserved or generated)
- Computed scores and confidence levels
- Timestamp and metadata

**File naming:**
`assessment_[repo-name]_[timestamp].json`

**Use cases:**
- Save your manual edits in Edge format
- Share assessments with team members
- Import back into Edge for analysis
- Archive assessment snapshots

## Workflow Example

### Complete Assessment Cycle

1. **Generate with Edge:**
   ```bash
   cd moderneer-edge
   npm run edge -- --repo=owner/repo
   ```

2. **Upload to Static UI:**
   - Open https://moderneer.co.uk/assessment/
   - Click Upload button (üì•)
   - Select the `assessment.json` from Edge output
   - UI auto-populates with all scores and evidence

3. **Review and Edit:**
   - See evidence tooltips (‚ö†Ô∏è) explaining each score
   - Adjust sliders and checkboxes based on your knowledge
   - Mark items as N/A if not applicable
   - Add notes or modify existing assessments

4. **Export Updated Assessment:**
   - Click Export button (üì§)
   - Downloads `assessment_[repo]_[timestamp].json`
   - File is in Edge format with your updates

5. **Re-import to Edge (if needed):**
   - Use the exported JSON for further analysis
   - Compare before/after assessments
   - Track progress over time

## Technical Details

### Edge Format Mapping

| Edge Field | Static UI | Notes |
|------------|-----------|-------|
| `check.score` (0-100) | checkbox/slider | Converted based on type |
| `check.check_type` | control type | check/scale5/scale100 |
| `check.evidence_excerpt` | ‚ö†Ô∏è tooltip | Hover to view |
| `check.answer` | stored as evidence | Fallback if no excerpt |
| `check.manual_review_required` | N/A checkbox | Disables control |
| `check.confidence` | not displayed | Stored in export |
| `parameter.parameter_score` | computed | Recalculated on export |
| `pillar.pillar_score` | computed | Recalculated on export |
| `overall_score` | computed | Overall index |

### Score Conversion

**Check type (Boolean):**
- Edge: score ‚â• 50 ‚Üí UI: checked
- UI: checked ‚Üí Edge: score = 100
- UI: unchecked ‚Üí Edge: score = 0

**Scale5 type (0-5 range):**
- Edge: score (0-100) ‚Üí UI: (score / 100) * 5
- UI: value (0-5) ‚Üí Edge: (value / 5) * 100

**Scale100 type (0-100 range):**
- Edge: score ‚Üí UI: score (direct)
- UI: value ‚Üí Edge: value (direct)

### Data Structure

The Edge integration module (`edge-integration.js`) provides:

- `loadEdgeAssessment(file)` - Parse uploaded JSON
- `populateFromEdgeAssessment(data, getSaved, setSaved)` - Fill UI
- `exportToEdgeFormat(selections, results, MODEL, PARAM_META)` - Generate Edge JSON
- `addEvidenceTooltip(element, evidence)` - Add tooltip icons

## Browser Compatibility

- Modern browsers with ES6 module support
- File API for upload/download
- No external dependencies required
- Works offline after initial page load

## Troubleshooting

**Upload button doesn't work:**
- Ensure assessment configuration is fully loaded
- Check browser console for errors
- Verify file is valid JSON

**Evidence tooltips not showing:**
- Hover directly over the ‚ö†Ô∏è icon
- Check that evidence_excerpt exists in the JSON
- Clear browser cache if tooltips appear broken

**Export generates wrong format:**
- Ensure you've computed results before export
- Check that MODEL is fully loaded
- Verify parameter mappings in console

**Scores don't match:**
- Remember score conversion formulas
- Check that parameter IDs match between Edge and static
- Review weight distributions in checks

## Future Enhancements

Potential improvements for future versions:

- [ ] Batch upload multiple assessments
- [ ] Side-by-side comparison view
- [ ] Evidence editing interface
- [ ] Confidence level adjustments
- [ ] File history and versioning
- [ ] Direct API integration with Edge
- [ ] Real-time collaboration
- [ ] Assessment templates

## Support

For issues or questions:
- Check browser console for detailed error messages
- Review this documentation
- Verify JSON format matches Edge v3.0.0 schema
- Test with a fresh assessment from Edge

## Version History

- **v1.0** (Nov 2025) - Initial release
  - Upload Edge assessment.json
  - Evidence tooltips with hover
  - Export to Edge format
  - Full round-trip support
