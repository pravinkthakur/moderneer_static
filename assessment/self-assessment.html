<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moderneer • Outcome Engineering Maturity</title>
  <meta name="theme-color" content="#3B82F6" />
  <link rel="stylesheet" href="../css/modern-2025.css" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Arial:400,700&display=swap" rel="stylesheet">
</head>
<body class="moderneer">
  <!-- Header Navigation Bar -->
  <header class="site" role="banner">
    <div class="container nav" aria-label="Primary">
      <a class="brand" href="../index.html">
        <img src="../assets/logo.jpg" alt="Moderneer logo" />
        <span>Moderneer</span>
      </a>
      <nav role="navigation" aria-label="Main navigation">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="../about.html">About</a></li>
          <li><a href="../maturity.html">Maturity Model</a></li>
          <li><a href="../ai-reverse-engineering.html">AI Reverse Engineering</a></li>
          <li><a href="../shift-left.html">Shift‑Left QE</a></li>
          <li><a href="../bootcamps.html">Bootcamps</a></li>
          <li><a href="../advisory.html">Advisory</a></li>
          <li><a href="../operating-models.html">Operating Models</a></li>
          <li><a href="../future-trends.html">Future Trends</a></li>
          <li><a href="../contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container section">
    <section class="hero">
      <div>
        <span class="badge">Outcome Engineering</span>
        <h1>Outcome Engineering Maturity Assessment</h1>
        <p class="lead">Evaluate your engineering practices across 24 core and 12 full pillars. Auto-scoring, gates, caps, and universal definitions included.</p>
        <button id="btnHelp" class="button secondary" aria-label="Open help and legend">Help / Legend</button>
      </div>
    </section>

    <section class="section cards">
      <div class="card">
        <div class="segmented">
          <button id="btnCore" class="active">Core 24</button>
          <button id="btnFull">Full 12 Pillars</button>
        </div>
        <div class="segmented" style="margin-top:10px;">
          <button id="btnViewPillar" class="active">By Pillar</button>
          <button id="btnViewTier">By Tier</button>
        </div>
        <div class="btn-group" style="margin-top:10px;">
          <button class="button" id="btnCompute">Compute</button>
          <button class="button secondary" id="btnSave">Save</button>
          <button class="button secondary" id="btnLoad">Load</button>
          <button class="button accent" id="btnReset">Reset</button>
          <button class="button secondary" id="btnExport">Export JSON</button>
        </div>
      </div>
      <div class="card">
        <div class="tiny">
          <b>Scales carry purpose:</b> click ⓘ to see why a measure exists & anchor definitions (e.g., P95 lead time 0=≥20d … 5=≤1d).
          <br/>Index→Scale: 0–25→1..2, 25–50→2..3, 50–80→3..4, 80–100→4..5. Gates & caps apply after weighting.
        </div>
        <div id="formArea"></div>
      </div>
    </section>

    <section class="section cards">
      <div class="card">
        <h2 class="h3">Results</h2>
        <div class="kpis">
          <div class="kpi"><div class="tiny">Overall (index 0–100)</div><strong id="overallIndex">—</strong></div>
          <div class="kpi"><div class="tiny">Overall (scale 1–5)</div><strong id="overallScale">—</strong></div>
          <div class="kpi"><div class="tiny">Band</div><strong id="overallBand">—</strong></div>
          <div class="kpi"><div class="tiny">Gates passed</div><strong id="gatesPassed">—</strong></div>
        </div>
        <h3 class="h3" style="margin-top:18px;">Gate & cap diagnostics</h3>
        <div id="gateList"></div>
        <h3 class="h3" style="margin-top:18px;">Breakdown</h3>
        <div id="pillarBreakdown"></div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div class="overlay" id="overlay" style="display:none;">
    <div class="modal">
      <header><strong id="modalTitle">Details</strong><button class="x" id="modalClose">Close</button></header>
      <div class="content" id="modalContent"></div>
    </div>
  </div>

  <footer role="contentinfo" class="footer">
    <small>© <span id="yr"></span> <strong>Moderneer</strong>. Outcome Engineering Maturity • v3.3</small>
  </footer>

  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();
    /* ---------- Scales (with purpose/anchors) ---------- */
const SCALE_CATALOG = {
  p95_lead_time:{label:"P95 Lead Time",purpose:"Shorten idea→production to tighten feedback loops.",anchors:["0 = ≥20 days","1 = ~15 days","2 = ~10 days","3 = ~5 days","4 = ~2 days","5 = ≤1 day"]},
  deploy_frequency:{label:"Deployment Frequency",purpose:"Increase safe delivery cadence to reduce batch size.",anchors:["0 = Monthly","1 = Bi-weekly","2 = Weekly","3 = 2–3×/week","4 = Daily","5 = Hourly"]},
  change_failure_rate:{label:"Change Failure Rate",purpose:"Ship safely by reducing incidents per deployment.",anchors:["0 = ≥40%","2 = ~25%","3 = ~15%","4 = ~8%","5 = ≤5% (↑ is better)"]},
  ci_feedback_time:{label:"CI Feedback Time",purpose:"Tighten developer loop to enable small, frequent changes.",anchors:["0 = ≥60m","1 = 45m","2 = 30m","3 = 20m","4 = 15m","5 = ≤10m"]},
  mttr_scale:{label:"MTTR",purpose:"Recover fast to protect user outcomes & error budgets.",anchors:["0 = ≥2 days","2 = ~8h","3 = ~2h","4 = ~45m","5 = ≤15m"]},
  slo_coverage_pct:{label:"SLO Coverage %",purpose:"Ensure reliability is defined where it matters.",anchors:["0–100% of services with SLOs"]},
  lineage_coverage_pct:{label:"Outcome Lineage %",purpose:"Trace PR→Feature→Event→KPI to attribute impact.",anchors:["0–100% merged PRs with lineage"]},
  eng_cust_hours:{label:"Engineer–Customer Hours",purpose:"Bring engineers closer to users to reduce rework.",anchors:["0 = 0h/qtr","1 = 1h","2 = 2h","3 = 4h","4 = 6h","5 = ≥8h per engineer/quarter"]},
  tagging_coverage_pct:{label:"Tagging Coverage %",purpose:"Expose cost-to-serve for financial decisions.",anchors:["0–100% resources correctly tagged"]},
  generic_0_5:{label:"Maturity (0–5)",purpose:"Rate the maturity of this capability.",anchors:["0 = Not at all","1 = Ad-hoc","2 = Emerging","3 = Defined","4 = Managed","5 = Optimised"]},
  generic_0_100:{label:"Coverage % (0–100)",purpose:"Estimate current coverage/completeness.",anchors:["0% = none → 100% = fully covered"]}
};

const DEFAULT_PURPOSE_BY_PREFIX = {
  strat:"Align strategy to measurable outcomes and governance.",
  cust:"Wire customer evidence and KPIs into daily work.",
  prod:"De-risk bets via discovery, prioritisation and GTM readiness.",
  arch:"Shape systems for safe change and extensibility.",
  eng:"Automate build/test/deploy and enable paved paths.",
  deliv:"Improve flow metrics and release safety.",
  reliab:"Protect user outcomes with SLOs, incidents and budgets.",
  sec:"Bake security, privacy and compliance into the lifecycle.",
  docs:"Make decisions and knowledge discoverable and auditable.",
  org:"Enable empowered, accountable, outcome-owning teams.",
  econ:"Expose costs and link spend to value outcomes.",
  data:"Ensure trustworthy data/ML with SLAs and oversight.",
  xp:"Deliver fast, inclusive experiences with feedback loops."
};

/* ---------- Meta (tiers, depends, purpose) ---------- */
const PARAM_META = {
  "eng.test_strategy":{tier:1,popular:true,purpose:"Fast, trustworthy feedback at unit→e2e levels.",dependsOn:[]},
  "eng.code_review_gates":{tier:1,purpose:"Consistent code/security gates via PRs.",dependsOn:[]},
  "docs.code_api_docs":{tier:1,purpose:"Docs-as-code; discoverable & fresh.",dependsOn:[]},
  "org.role_triad":{tier:1,purpose:"Clear EM/PM/Design decision rights.",dependsOn:[]},
  "cust.kpi_literacy":{tier:1,purpose:"Teams read & act on KPIs; shared vocabulary.",dependsOn:[]},

  "deliv.lead_time":{tier:2,popular:true,purpose:"Shorten change lead time; primary flow signal.",dependsOn:["eng.test_strategy","eng.code_review_gates","eng.dev_workflow"]},
  "deliv.flow_efficiency":{tier:2,purpose:"Visualise queues; reduce wait vs work.",dependsOn:["deliv.lead_time"]},
  "eng.dev_workflow":{tier:2,purpose:"Reproducible local/cloud dev; fast bootstraps.",dependsOn:[]},
  "eng.cicd":{tier:2,popular:true,purpose:"Automated build/test/deploy; ship often & safely.",dependsOn:["eng.test_strategy","eng.dev_workflow"]},
  "arch.modularity":{tier:2,purpose:"Right-sized modules/services to limit blast radius.",dependsOn:[]},

  "deliv.release_safety":{tier:3,popular:true,purpose:"Progressive delivery, flags, rollback.",dependsOn:["eng.cicd"]},
  "reliab.incident_mgmt":{tier:3,purpose:"Coordinated response; RCAs & drills.",dependsOn:["arch.obs_by_design"]},
  "reliab.mttr_budget":{tier:3,popular:true,purpose:"Error budgets policies + MTTR tracking.",dependsOn:["arch.obs_by_design","reliab.incident_mgmt"]},
  "arch.obs_by_design":{tier:3,popular:true,purpose:"Golden signals, tracing & runbooks.",dependsOn:[]},

  "cust.proximity":{tier:4,popular:true,purpose:"Engineers meet users; evidence flows in.",dependsOn:[]},
  "cust.outcome_trace":{tier:4,popular:true,purpose:"PR→Feature→Event→KPI lineage for attribution.",dependsOn:["data.data_sla_lineage"]},
  "reliab.slos_product":{tier:4,popular:true,purpose:"Product-relevant SLOs & budget policy.",dependsOn:["arch.obs_by_design"]},
  "prod.discovery":{tier:4,purpose:"Derisk bets via experiments & guardrails.",dependsOn:["cust.problem_framing"]},
  "cust.problem_framing":{tier:4,purpose:"Evidence-first problem statements.",dependsOn:[]},

  "econ.cost_to_serve":{tier:5,popular:true,purpose:"Cost per request/segment drives choices.",dependsOn:["eng.iac_gitops","eng.cloud_enable"]},
  "econ.squad_budget":{tier:5,purpose:"Local budget ownership & reallocation.",dependsOn:["econ.cost_to_serve"]},
  "data.data_sla_lineage":{tier:5,purpose:"Data contracts, lineage & quality SLAs.",dependsOn:[]},
  "arch.api_product":{tier:5,purpose:"API as product: SLAs, adoption, analytics.",dependsOn:["arch.modularity"]},

  "prod.gtm_readiness":{tier:6,purpose:"Enablement, support & rollback plans.",dependsOn:["deliv.release_safety"]},
  "econ.finops":{tier:6,purpose:"Policy-driven cloud savings & forecasts.",dependsOn:["econ.cost_to_serve","eng.iac_gitops"]},
  "data.model_lifecycle":{tier:6,purpose:"Drift monitors, rollback, cadence.",dependsOn:["data.data_sla_lineage"]},
  "data.responsible_ai":{tier:6,purpose:"Fairness, HITL, auditability.",dependsOn:["data.model_lifecycle"]},
  "xp.perf_budgets_rum":{tier:6,popular:true,purpose:"Perceived perf tied to KPIs.",dependsOn:["eng.cicd"]},
  "xp.accessibility":{tier:6,purpose:"Inclusive usage (WCAG).",dependsOn:[]},
  "xp.i18n_l10n":{tier:6,purpose:"Global readiness.",dependsOn:[]},
  "xp.support_integration":{tier:6,purpose:"Close loop with Customer Support.",dependsOn:[]},
  "strat.okr_link":{tier:6,popular:true,purpose:"Connect strategy→OKRs→metrics; governance.",dependsOn:["cust.kpi_literacy"]},
  "strat.portfolio_review":{tier:6,purpose:"Evidence-based allocation/kill.",dependsOn:["cust.outcome_trace","reliab.slos_product"]},
  "strat.exec_narrative":{tier:6,purpose:"Single story across customer, tech, finance.",dependsOn:[]},
  "strat.decision_reversible":{tier:6,purpose:"Fast, reversible decisions.",dependsOn:["docs.adrs_quality"]},
  "deliv.planning_adapt":{tier:6,purpose:"Metrics-driven replanning cadence.",dependsOn:["strat.okr_link"]},
  "arch.evolutionary":{tier:6,purpose:"Fitness functions in CI; guided change.",dependsOn:["eng.test_strategy","eng.cicd"]},
  "eng.iac_gitops":{tier:6,purpose:"Infra as code; drift & policy control.",dependsOn:[]},
  "eng.cloud_enable":{tier:6,purpose:"Paved paths, managed services, guardrails.",dependsOn:[]},
  "reliab.anomaly":{tier:6,purpose:"Change-aware alerting, fatigue control.",dependsOn:["arch.obs_by_design"]},
  "sec.secure_coding":{tier:6,popular:true,purpose:"Supply chain & code security.",dependsOn:["eng.cicd"]},
  "sec.privacy_data":{tier:6,purpose:"Lawful, safe data usage.",dependsOn:["data.data_sla_lineage"]},
  "sec.compliance_evidence":{tier:6,purpose:"Evidence-as-code, audit-ready.",dependsOn:["eng.cicd"]},
  "sec.runtime_ir":{tier:6,purpose:"Detect/contain/respond.",dependsOn:["reliab.incident_mgmt"]},
  "docs.knowledge_onboarding":{tier:6,purpose:"Reduce time-to-first-PR.",dependsOn:["docs.code_api_docs"]},
  "docs.adrs_quality":{tier:6,popular:true,purpose:"Decision quality, reversals & traceability.",dependsOn:[]},
  "docs.audit_trace":{tier:6,purpose:"End-to-end accountability.",dependsOn:[]},
  "org.team_autonomy":{tier:6,purpose:"Own problem→ops within guardrails.",dependsOn:["org.role_triad"]},
  "org.growth_calibration":{tier:6,purpose:"Fair, evidence-based growth.",dependsOn:[]},
  "org.leadership_behaviour":{tier:6,purpose:"Unblockers; outcome-first leadership.",dependsOn:[]},
  "econ.pricing_levers":{tier:6,purpose:"Telemetry-informed pricing tests.",dependsOn:["data.analytics_selfserve"]},
  "prod.prioritisation":{tier:6,purpose:"Value/risk sequencing tied to OKRs.",dependsOn:["cust.problem_framing"]},
  "prod.roadmapping":{tier:6,purpose:"Outcome-based, scenario-aware plans.",dependsOn:["strat.okr_link"]},
  "data.analytics_selfserve":{tier:6,purpose:"Speed to insight; self-serve.",dependsOn:["data.data_sla_lineage"]}
};

/* ---------- Model (weights, gates, caps) ---------- */
const MODEL = {
  weights: {
    "Strategy & Executive Alignment": 8,
    "Customer & Outcome Alignment": 12,
    "Product Strategy, Discovery & GTM": 10,
    "Architecture & Extensibility": 8,
    "Engineering & Platform Automation": 12,
    "Delivery Flow & Velocity": 12,
    "Reliability, Security & Compliance": 14,
    "Documentation, Decisioning & Traceability": 4,
    "Organisation, Leadership & Autonomy": 6,
    "Outcome Economics & Finance": 4,
    "Data & AI Lifecycle": 6,
    "Experience Quality & Market Readiness": 4
  },
  gates: [
    { id:"G1", label:"Outcome traceability ≥ 4", params:["cust.outcome_trace"], logical:"AND", threshold:4.0 },
    { id:"G2", label:"Lead time ≥ 4 AND Release safety ≥ 4", params:["deliv.lead_time","deliv.release_safety"], logical:"AND", threshold:4.0 },
    { id:"G3", label:"SLOs & MTTR ≥ 4", params:["reliab.slos_product","reliab.mttr_budget"], logical:"AND", threshold:4.0 },
    { id:"G4", label:"Customer proximity & KPI literacy ≥ 4", params:["cust.proximity","cust.kpi_literacy"], logical:"AND", threshold:4.0 },
    { id:"G5", label:"Strategy→OKR ≥ 3.5", params:["strat.okr_link"], logical:"AND", threshold:3.5 },
    { id:"G6", label:"Cost-to-serve & Squad budget ≥ 3.5", params:["econ.cost_to_serve","econ.squad_budget"], logical:"AND", threshold:3.5 }
  ],
  caps: [
    { label:"Cap 2.4 if Lead time < 3 or Release < 3", params:["deliv.lead_time","deliv.release_safety"], logic:"OR", cap:2.4, lt:3.0 },
    { label:"Cap 2.9 if Customer proximity ≤ 2", params:["cust.proximity"], logic:"LE", cap:2.9, value:2.0 },
    { label:"Cap 3.0 if Outcome traceability ≤ 2", params:["cust.outcome_trace"], logic:"LE", cap:3.0, value:2.0 }
  ],
  core24: [
    "strat.okr_link","strat.portfolio_review",
    "cust.proximity","cust.outcome_trace",
    "prod.discovery","prod.gtm_readiness",
    "arch.obs_by_design","arch.api_product",
    "eng.test_strategy","eng.cicd","eng.iac_gitops","eng.cloud_enable",
    "deliv.lead_time","deliv.release_safety","deliv.flow_efficiency",
    "reliab.mttr_budget","reliab.slos_product","sec.secure_coding",
    "docs.adrs_quality","org.team_autonomy",
    "econ.cost_to_serve","econ.squad_budget",
    "data.data_sla_lineage","xp.perf_budgets_rum"
  ],
  fullModel: {
    pillars: [
      { name:"Strategy & Executive Alignment", parameters:["strat.okr_link","strat.portfolio_review","strat.exec_narrative","strat.decision_reversible"] },
      { name:"Customer & Outcome Alignment", parameters:["cust.proximity","cust.kpi_literacy","cust.problem_framing","cust.outcome_trace"] },
      { name:"Product Strategy, Discovery & GTM", parameters:["prod.discovery","prod.prioritisation","prod.roadmapping","prod.gtm_readiness"] },
      { name:"Architecture & Extensibility", parameters:["arch.modularity","arch.evolutionary","arch.api_product","arch.obs_by_design"] },
      { name:"Engineering & Platform Automation", parameters:["eng.test_strategy","eng.code_review_gates","eng.dev_workflow","eng.cicd","eng.iac_gitops","eng.cloud_enable"] },
      { name:"Delivery Flow & Velocity", parameters:["deliv.lead_time","deliv.release_safety","deliv.flow_efficiency","deliv.planning_adapt"] },
      { name:"Reliability, Security & Compliance", parameters:["reliab.incident_mgmt","reliab.mttr_budget","reliab.slos_product","reliab.anomaly","sec.secure_coding","sec.privacy_data","sec.compliance_evidence","sec.runtime_ir"] },
      { name:"Documentation, Decisioning & Traceability", parameters:["docs.code_api_docs","docs.knowledge_onboarding","docs.adrs_quality","docs.audit_trace"] },
      { name:"Organisation, Leadership & Autonomy", parameters:["org.role_triad","org.team_autonomy","org.growth_calibration","org.leadership_behaviour"] },
      { name:"Outcome Economics & Finance", parameters:["econ.cost_to_serve","econ.squad_budget","econ.pricing_levers","econ.finops"] },
      { name:"Data & AI Lifecycle", parameters:["data.data_sla_lineage","data.model_lifecycle","data.responsible_ai","data.analytics_selfserve"] },
      { name:"Experience Quality & Market Readiness", parameters:["xp.perf_budgets_rum","xp.accessibility","xp.i18n_l10n","xp.support_integration"] }
    ],
    parameters: {
      "deliv.lead_time": { label:"Lead time for change", checks:[
        {type:"check",  w:18, label:"DORA/VCS export available (90d)"},
        {type:"scale5", w:22, label:"P95 lead time (lower is better)", scaleRef:"p95_lead_time", purpose:"Lower time ⇒ faster learning cycles."},
        {type:"check",  w:14, label:"WIP limits enforced"},
        {type:"check",  w:12, label:"Blocker ageing alerts"},
        {type:"check",  w:10, label:"Small PR policy"},
        {type:"check",  w:8,  label:"Pair/mob or PR-buddy rotation"},
        {type:"check",  w:8,  label:"Trunk-based or short-lived branches"},
        {type:"check",  w:8,  label:"Weekly review of slowest 10% PRs"}
      ]},
      "eng.test_strategy": { label:"Test strategy", checks:[
        {type:"check",  w:18, label:"Test pyramid ratios documented"},
        {type:"check",  w:16, label:"CI enforces min test gates"},
        {type:"check",  w:12, label:"Contract tests between services"},
        {type:"check",  w:10, label:"Test data mgmt (synthetic/anonymised)"},
        {type:"check",  w:10, label:"Flake tracking & quarantine"},
        {type:"check",  w:10, label:"Performance tests for critical paths"},
        {type:"check",  w:8,  label:"AI-assisted/mutation testing used"},
        {type:"scale5", w:16, label:"Median CI feedback time (lower is better)", scaleRef:"ci_feedback_time", purpose:"Tight loop enables small batches."}
      ]},
      "reliab.mttr_budget": { label:"MTTR & error budgets", checks:[
        {type:"check",  w:16, label:"Error budgets defined per service"},
        {type:"check",  w:14, label:"Budget burn dashboard live"},
        {type:"check",  w:12, label:"Budget policy (throttle/gate) documented"},
        {type:"check",  w:14, label:"≥2 policy activations last quarter"},
        {type:"scale5", w:22, label:"Incident MTTR (lower is better)", scaleRef:"mttr_scale", purpose:"Faster recovery protects outcomes."},
        {type:"check",  w:8,  label:"Auto-page/auto-ticket wired"},
        {type:"check",  w:8,  label:"Budget breaches reviewed in planning"},
        {type:"check",  w:6,  label:"Incident playbooks link to budget view"}
      ]},
      "reliab.slos_product": { label:"SLOs & product impact", checks:[
        {type:"check",   w:16, label:"SLOs defined (latency/errors/availability)"},
        {type:"check",   w:14, label:"SLOs declared in code/config"},
        {type:"check",   w:14, label:"Error budget tied to release gating"},
        {type:"check",   w:12, label:"Customer impact quantified (rev at risk)"},
        {type:"check",   w:10, label:"Runbooks link from SLO alerts"},
        {type:"check",   w:10, label:"SLO reviews in PM & on-call rituals"},
        {type:"scale100",w:24, label:"SLO coverage % (higher is better)", scaleRef:"slo_coverage_pct", purpose:"Wider coverage ⇒ reliability by design."}
      ]},
      "cust.proximity": { label:"Customer proximity", checks:[
        {type:"scale5",  w:28, label:"Engineer–customer hours (higher is better)", scaleRef:"eng_cust_hours", purpose:"Direct exposure prevents rework."},
        {type:"check",   w:16, label:"Engineers join discovery/shadow sessions"},
        {type:"check",   w:12, label:"Notes linked to backlog items"},
        {type:"check",   w:12, label:"Quarterly pipeline of sessions planned"},
        {type:"check",   w:10, label:"Post-release sessions / support ride-alongs"},
        {type:"check",   w:8,  label:"Recordings accessible to squad"},
        {type:"check",   w:7,  label:"Finding→change linkage logged"},
        {type:"check",   w:7,  label:"Quarterly roll-up of insights & actions"}
      ]},
      "cust.outcome_trace": { label:"Outcome traceability (PR→Feature→Event→KPI)", checks:[
        {type:"check",   w:16, label:"Event schema in PRs (owner, fields, KPI)"},
        {type:"check",   w:14, label:"Deploy SHA joined to event stream"},
        {type:"check",   w:12, label:"Flag/experiment ID linked to PR"},
        {type:"check",   w:12, label:"KPI chart linked in PR/ticket"},
        {type:"check",   w:12, label:"Automated lineage view exists"},
        {type:"scale100",w:22, label:"Lineage coverage % (higher is better)", scaleRef:"lineage_coverage_pct", purpose:"Attribution coverage."},
        {type:"check",   w:7,  label:"Attribution notes: expected vs actual delta"},
        {type:"check",   w:5,  label:"Event data quality checks & alerts"}
      ]},
      "eng.cicd": { label:"CI/CD maturity", checks:[
        {type:"check",  w:16, label:"Pipeline as code with reviews"},
        {type:"check",  w:16, label:"Automated deploy to prod/staging"},
        {type:"check",  w:14, label:"Post-deploy verification (smoke/health/KPIs)"},
        {type:"check",  w:12, label:"Feature flags supported"},
        {type:"check",  w:10, label:"Canary/blue-green available"},
        {type:"check",  w:10, label:"Automated rollback hook"},
        {type:"scale5", w:12, label:"Deployment frequency (higher is better)", scaleRef:"deploy_frequency", purpose:"Smaller batches, lower risk."},
        {type:"scale5", w:10, label:"Change failure rate (lower is better)", scaleRef:"change_failure_rate", purpose:"Safety of delivery."}
      ]},
      "econ.cost_to_serve": { label:"Cost-to-serve visibility", checks:[
        {type:"check",   w:18, label:"Tagging standards implemented"},
        {type:"check",   w:14, label:"Dashboard: cost per request/segment"},
        {type:"check",   w:12, label:"Allocation method documented"},
        {type:"check",   w:12, label:"Trends vs SLO compliance visible"},
        {type:"check",   w:10, label:"Alerts on anomaly spikes"},
        {type:"check",   w:10, label:"Monthly review in squad & product forums"},
        {type:"scale100",w:14, label:"Tagging coverage % (higher is better)", scaleRef:"tagging_coverage_pct", purpose:"Transparency of spend."},
        {type:"check",   w:10, label:"Accuracy spot-checks performed"}
      ], purpose:"Expose cost-to-serve for financial decisions."},

      /* Remaining parameters (auto-profiled) */
      "strat.okr_link": { label:"Strategy → OKR linkage", checks:[
        {label:"Strategy tree documented & versioned"},{label:"≥80% squads have OKRs with owners & dates"},
        {label:"OKR quality rubric ≥ 3/5 per squad"},{label:"Quarterly OKR reviews with minutes"},
        {label:"Each KR links to instrumented metric"},{label:"Dependencies mapped; cross-team alignment"},
        {label:"Outcome deltas recorded post-quarter"},{label:"OKR registry searchable (tags)"}
      ]},
      "strat.portfolio_review": { label:"Portfolio bet review", checks:[
        {label:"Quarterly portfolio review held"},{label:"Bets framed with expected KPI uplift ranges"},
        {label:"Evidence pack template used"},{label:"% budget reallocated based on evidence"},
        {label:"Kill/continue decisions logged"},{label:"Risks/assumptions register updated"},
        {label:"Scenario analysis for top bets"},{label:"Portfolio dashboard org-visible"}
      ]},
      "strat.exec_narrative": { label:"Executive single narrative", checks:[
        {label:"Narrative links customer/tech/finance"},{label:"Versioned & refreshed quarterly"},
        {label:"Referenced in exec reviews/QBRs"},{label:"KPIs aligned to narrative themes"},
        {label:"Org-wide accessible/searchable"},{label:"Feedback loop to update"}
      ]},
      "strat.decision_reversible": { label:"Decision cadence & reversibility", checks:[
        {label:"ADRs mandatory for key decisions"},{label:"Decision latency tracked"},
        {label:"Reversal protocol defined"},{label:"Reversal yield measured"},
        {label:"Sunset/stop criteria documented"},{label:"Periodic retro on major decisions"}
      ]},
      "cust.kpi_literacy": { label:"KPI literacy", checks:[
        {label:"KPI registry with owners & formulas"},{label:"KPI quiz ≥ threshold"},
        {label:"Work items link to target KPI"},{label:"KPI dashboards in rituals"},
        {label:"Pre-release KPI forecast captured"},{label:"Post-release delta reviewed"}
      ]},
      "cust.problem_framing": { label:"Problem framing", checks:[
        {label:"Opportunity solution tree maintained"},{label:"Assumptions log with tests"},
        {label:"Impact sizing documented"},{label:"Customer evidence attached"},
        {label:"Alternatives compared"},{label:"Triad-approved problem statement"}
      ]},
      "prod.discovery": { label:"Discovery & experiments", checks:[
        {label:"Experiment template with hypothesis & MDE"},{label:"Decision log links outcomes to experiments"},
        {label:"Interview schedule & participant sourcing"},{label:"Guardrail metrics defined"},
        {label:"A/B or cohort platform with audit"},{label:"Median time-to-insight ≤ 14 days"},
        {label:"Quarterly kill-rate reported"},{label:"Opportunity solution trees up to date"}
      ]},
      "prod.prioritisation": { label:"Prioritisation method", checks:[
        {label:"Impact/risk/confidence/TTV scored"},{label:"Option value or sequencing captured"},
        {label:"Assumptions & ranges explicit"},{label:"Result ties to strategy/OKRs"},
        {label:"Periodic re-prioritisation"},{label:"Decision log linked"}
      ]},
      "prod.roadmapping": { label:"Roadmapping", checks:[
        {label:"Outcome-based roadmap"},{label:"Dependencies & risks mapped"},
        {label:"Replan cycle ≤ quarterly"},{label:"Scenario/guardrails defined"},
        {label:"Capacity assumptions listed"},{label:"Public, versioned roadmap"}
      ]},
      "prod.gtm_readiness": { label:"Go-to-market readiness", checks:[
        {label:"Launch playbook approved"},{label:"Cohorting plan & ramp schedule"},
        {label:"Enablement docs/demo/training"},{label:"Support runbook & taxonomy ready"},
        {label:"Pricing/packaging w/ telemetry"},{label:"Readiness gates passed"},
        {label:"Rollback/comms plan rehearsed"},{label:"Post-launch metrics owner set"}
      ]},
      "arch.modularity": { label:"Modularity", checks:[
        {label:"Domain/capability map defined"},{label:"Service/module boundaries documented"},
        {label:"Ownership per module clear"},{label:"Change blast radius measured"},
        {label:"Dependency graph maintained"},{label:"Refactoring backlog exists"}
      ]},
      "arch.evolutionary": { label:"Evolutionary architecture", checks:[
        {label:"Fitness functions defined"},{label:"Fitness tests in CI"},
        {label:"Architecture runway documented"},{label:"Policy failures tracked"},
        {label:"Refactor budget set"},{label:"Architecture reviews regular"}
      ]},
      "arch.api_product": { label:"API productisation", checks:[
        {label:"OpenAPI/IDL versioned"},{label:"Contract tests in CI"},
        {label:"SLAs/SLOs defined"},{label:"API portal with docs/examples"},
        {label:"SDKs/client libraries maintained"},{label:"Usage analytics dashboard"},
        {label:"Quota/auth policies enforced"},{label:"Onboarding time ≤ target"}
      ]},
      "arch.obs_by_design": { label:"Observability by design", checks:[
        {label:"Golden signals selected per service"},{label:"SLOs defined in code/config"},
        {label:"Tracing enabled on critical paths"},{label:"Logs/metrics/traces correlation (traceID)"},
        {label:"Dashboards reviewed in on-call & planning"},{label:"Alert runbooks linked"},
        {label:"Telemetry coverage reported"},{label:"Synthetic checks or RUM enabled"}
      ]},
      "eng.code_review_gates": { label:"Code review & gates", checks:[
        {label:"Peer review required"},{label:"Static checks/lint/format enforced"},
        {label:"Quality/security gates on PR"},{label:"AI assist guardrails"},
        {label:"Review SLA tracked"},{label:"Rollback/test evidence in PR"}
      ]},
      "eng.dev_workflow": { label:"Dev workflow", checks:[
        {label:"Dev containers or cloud IDE"},{label:"PR previews with seeded data"},
        {label:"One-command bootstrap"},{label:"Local/prod parity documented"},
        {label:"Toolchain version pinning"},{label:"Setup time ≤ target"}
      ]},
      "eng.iac_gitops": { label:"IaC & GitOps", checks:[
        {label:"Infra provisioned via code"},{label:"Infra changes via PR only"},
        {label:"GitOps controller & drift detection"},{label:"Policy as code with audit"},
        {label:"Secrets management integrated & scanned"},{label:"Ephemeral envs via PR"},
        {label:"Infra cost tags enforced"},{label:"Drift incidents tracked with MTTR"}
      ]},
      "eng.cloud_enable": { label:"Cloud & stack enablement", checks:[
        {label:"Paved path templates (service/worker/job/UI)"},{label:"Managed services catalogue"},
        {label:"Golden path docs with SLA"},{label:"Per-squad infra control with guardrails"},
        {label:"Standard telemetry baked into templates"},{label:"PR preview envs with URLs"},
        {label:"Adoption metrics published"},{label:"Legacy stack decommission rules"}
      ]},
      "deliv.release_safety": { label:"Release cadence & safety", checks:[
        {label:"Feature flags in production"},{label:"Canary with automated health gates"},
        {label:"Rollback rehearsal ≤ 15 min"},{label:"Blast radius control (cohorting/%)"},
        {label:"Deployment frequency targets"},{label:"Release freeze rules tied to SLO burn"},
        {label:"CAB equivalence pack (if regulated)"},{label:"Post-release KPI check ≤ 24h"}
      ]},
      "deliv.flow_efficiency": { label:"Flow efficiency & WIP", checks:[
        {label:"Value stream map maintained"},{label:"Flow efficiency metric tracked"},
        {label:"Constraint register with owners"},{label:"Auto-flags for blocked >24h"},
        {label:"Swimlanes & policies for expedite"},{label:"Arrival/departure rate dashboard"},
        {label:"Queue age visualised"},{label:"Monthly Kaizen on top constraint"}
      ]},
      "deliv.planning_adapt": { label:"Planning cadence & adaptability", checks:[
        {label:"Quarterly OKRs set & tracked"},{label:"Decision records maintained"},
        {label:"Weekly evidence review (metrics)"},{label:"Replan rules documented"},
        {label:"Stakeholder comms cadence"},{label:"Risk/assumption updates"}
      ]},
      "reliab.incident_mgmt": { label:"Incident management", checks:[
        {label:"On-call rota & escalation"},{label:"Blameless RCA template used"},
        {label:"Runbooks per top alerts"},{label:"Drills/table-tops held"},
        {label:"Action items tracked to closure"},{label:"Incident metrics dashboard"}
      ]},
      "reliab.anomaly": { label:"Anomaly detection", checks:[
        {label:"Alert thresholds tuned"},{label:"Change-aware alerting (deploy link)"},
        {label:"False positive rate monitored"},{label:"Context enrichment (runbook/owner)"},
        {label:"ML/heuristics evaluated"},{label:"Alert fatigue reviews"}
      ]},
      "sec.secure_coding": { label:"Secure coding & supply chain", checks:[
        {label:"SAST/DAST in CI with gates"},{label:"Dependency scanning & license policy"},
        {label:"SBOM per build stored"},{label:"Signed builds/provenance"},
        {label:"Secrets scanners in CI/repos"},{label:"Threat models maintained"},
        {label:"Security training ≥ threshold"},{label:"Vuln SLA tracking & exceptions"}
      ]},
      "sec.privacy_data": { label:"Privacy & data handling", checks:[
        {label:"Data maps & lawful basis recorded"},{label:"PII tracing by flow"},
        {label:"Retention/deletion jobs automated"},{label:"Consent checks enforced"},
        {label:"DPIAs completed & stored"},{label:"Privacy incident runbook"}
      ]},
      "sec.compliance_evidence": { label:"Compliance evidence", checks:[
        {label:"Controls mapped to ISO/SOC"},{label:"Evidence as code (artifacts)"},
        {label:"Evidence freshness dashboard"},{label:"Sampling window defined"},
        {label:"Immutable audit trail"},{label:"Alerts on stale/missing evidence"}
      ]},
      "sec.runtime_ir": { label:"Runtime security & IR", checks:[
        {label:"SIEM integrated with product"},{label:"Playbooks & containment steps"},
        {label:"MTTD/MTTR security tracked"},{label:"Drills with KPIs"},
        {label:"Forensics capability defined"},{label:"Post-incident learning captured"}
      ]},
      "docs.code_api_docs": { label:"Code & API docs", checks:[
        {label:"Docs as code (in repo)"},{label:"Freshness checks in CI"},
        {label:"Usage analytics"},{label:"API examples validated"},
        {label:"Docs ownership listed"},{label:"SLA for doc updates"}
      ]},
      "docs.knowledge_onboarding": { label:"Knowledge sharing & onboarding", checks:[
        {label:"Onboarding path with checkpoints"},{label:"Time to first PR tracked"},
        {label:"Recorded walkthroughs"},{label:"Glossary of systems"},
        {label:"Self-serve labs/sandboxes"},{label:"Feedback loop on path"}
      ]},
      "docs.adrs_quality": { label:"ADRs & decision quality", checks:[
        {label:"ADR template with IDs & owners"},{label:"Decision latency tracked"},
        {label:"Reversal decisions recorded"},{label:"ADRs link to expected impact"},
        {label:"Decision quality review"},{label:"Discoverable/indexed"},
        {label:"Cross-team visibility"},{label:"Deprecated ADRs mark successors"}
      ]},
      "docs.audit_trace": { label:"Audit & traceability", checks:[
        {label:"User & system action logging"},{label:"Searchable within minutes"},
        {label:"Tamper-evident storage"},{label:"Least privilege enforced"},
        {label:"Retention policy documented"},{label:"Access audit reports"}
      ]},
      "org.role_triad": { label:"Role clarity & triad", checks:[
        {label:"EM/Product/Design triad named"},{label:"Decision rights documented"},
        {label:"Triad rituals (weekly)"},{label:"Escalation routes"},
        {label:"Role backfills planned"},{label:"Outcome ownership in goals"}
      ]},
      "org.team_autonomy": { label:"Team autonomy & ownership", checks:[
        {label:"Decision rights matrix (RACI)"},{label:"Squad owns on-call & incidents"},
        {label:"Squad owns service catalogue entries"},{label:"Infra controls with guardrails"},
        {label:"Low-risk changes approved in squad"},{label:"Autonomy score surveyed"},
        {label:"Escalation paths documented"},{label:"Ops cost prompts in planning"}
      ]},
      "org.growth_calibration": { label:"Growth & calibration", checks:[
        {label:"Lattice with competencies"},{label:"Evidence-based calibration"},
        {label:"Peer/skip calibration"},{label:"Calibration transparency"},
        {label:"Promotion packet template"},{label:"Calibration cadence defined"}
      ]},
      "org.leadership_behaviour": { label:"Leadership behaviour", checks:[
        {label:"Blocker removal SLA"},{label:"AMAs/surveys (listening)"},
        {label:"Systems thinking training"},{label:"Outcome-based goals"},
        {label:"Recognise learning, not just output"},{label:"Visible retros/actions"}
      ]},
      "econ.squad_budget": { label:"Squad budget accountability", checks:[
        {label:"Budget envelope defined"},{label:"Guardrails (limits/approvals)"},
        {label:"Monthly variance tracking"},{label:"Spend vs outcome review"},
        {label:"Reallocate within envelope"},{label:"Quarterly reconciliation"},
        {label:"Cost forecasts in planning"},{label:"Experiment spend tracked"}
      ]},
      "econ.pricing_levers": { label:"Pricing & value levers", checks:[
        {label:"Telemetry inputs to pricing"},{label:"Pricing experiment framework"},
        {label:"Change cycle time measured"},{label:"Cohort guardrails defined"},
        {label:"Packaging linked to outcomes"},{label:"Revenue impact tracked"}
      ]},
      "econ.finops": { label:"FinOps practice", checks:[
        {label:"Tagging coverage ≥ threshold"},{label:"Policy engine (alerts/suggestions)"},
        {label:"Savings tracked & attributed"},{label:"Budget vs forecast dashboards"},
        {label:"Rightsizing/RI playbooks"},{label:"Monthly FinOps review"}
      ]},
      "data.data_sla_lineage": { label:"Data quality SLAs & lineage", checks:[
        {label:"Data contracts defined (schema+SLAs)"},{label:"Lineage graph (source→sink→dashboard)"},
        {label:"Freshness/completeness monitors"},{label:"Breach routing to owners"},
        {label:"Backfills automated/scripted"},{label:"Ownership metadata complete"},
        {label:"Test datasets/sandbox defined"},{label:"Quarterly data review with product"}
      ]},
      "data.model_lifecycle": { label:"Model lifecycle & monitoring", checks:[
        {label:"Model registry with versions & lineage"},{label:"Drift/perf monitors with alerts"},
        {label:"Rollback/disable automation"},{label:"Feature store documented"},
        {label:"Shadow/canary deploys"},{label:"Retraining cadence & data SLAs"}
      ]},
      "data.responsible_ai": { label:"Responsible AI", checks:[
        {label:"Model cards completed"},{label:"Bias/fairness tests stored"},
        {label:"Human-in-the-loop defined"},{label:"Appeal/override route"},
        {label:"PII/consent checks"},{label:"Audit trail preserved"}
      ]},
      "data.analytics_selfserve": { label:"Analytics self-serve", checks:[
        {label:"Access control & catalog"},{label:"Dashboards per squad"},
        {label:"Analytics DAU/MAU telemetry"},{label:"Query templates"},
        {label:"Training/how-tos"},{label:"Query latency SLAs"}
      ]},
      "xp.perf_budgets_rum": { label:"Performance budgets & RUM", checks:[
        {label:"Perf budgets per page/flow"},{label:"Budgets enforced in CI"},
        {label:"RUM instrumented on key flows"},{label:"Perf dashboards with cohorts"},
        {label:"PR perf regression auto-flags"},{label:"Perf SLOs tied to KPIs"},
        {label:"Synthetic checks for critical flows"},{label:"Perf remediation backlog"}
      ]},
      "xp.accessibility": { label:"Accessibility & inclusion", checks:[
        {label:"WCAG targets & audits scheduled"},{label:"Automated a11y linters in CI"},
        {label:"Manual audits on critical flows"},{label:"Inclusive research participants"},
        {label:"A11y debt backlog & SLA"},{label:"Assistive tech test plan"}
      ]},
      "xp.i18n_l10n": { label:"Internationalisation & localisation", checks:[
        {label:"i18n frameworks in code"},{label:"Locale files & workflows"},
        {label:"Currency/timezone handling"},{label:"Localisation QA process"},
        {label:"Market toggles/feature flags"},{label:"Locale bug rate tracked"}
      ]},
      "xp.support_integration": { label:"Support integration", checks:[
        {label:"Ticket taxonomy aligns to backlog"},{label:"Deflection & CSAT shared"},
        {label:"Auto-label/route to squads"},{label:"Support runbooks per issue"},
        {label:"Feedback loop into roadmap"},{label:"Quarterly CS×Eng review"}
      ]}
    }
  }
};

/* ---------- Backfill weights/slider meta ---------- */
const TAPER8=[20,15,15,15,10,10,10,5], TAPER6=[20,20,15,15,15,15];
function patchModel(){
  const P = MODEL.fullModel.parameters;
  Object.keys(P).forEach(pid=>{
    PARAM_META[pid] = PARAM_META[pid] || {};
    if(!PARAM_META[pid].purpose){
      const pref = pid.split('.')[0];
      PARAM_META[pid].purpose = DEFAULT_PURPOSE_BY_PREFIX[pref] || "Purpose: see checks below.";
    }
  });
  for(const pid of Object.keys(P)){
    const def = P[pid];
    def.checks.forEach(ch=>{ if(!ch.type) ch.type="check"; });
    const hasW = def.checks.some(ch=> typeof ch.w==="number");
    if(!hasW){
      const n=def.checks.length; let prof=(n===8?TAPER8:(n===6?TAPER6:null));
      if(!prof){
        prof = Array.from({length:n},(_,i)=> Math.max(8, Math.round(100*Math.pow(0.88,i))));
        const s=prof.reduce((a,b)=>a+b,0); prof=prof.map(x=>Math.round(100*x/s));
        const d=100-prof.reduce((a,b)=>a+b,0); if(d) prof[0]+=d;
      }
      def.checks.forEach((ch,i)=> ch.w = prof[i]);
    } else {
      const s = def.checks.reduce((a,ch)=>a+(ch.w||0),0);
      if(s>0) def.checks.forEach(ch=> ch.w = +(ch.w*100/s).toFixed(2));
    }
    def.checks.forEach(ch=>{
      if(ch.type==="check"){
        const L=(ch.label||"").toLowerCase();
        if(/coverage %|slo coverage|lineage|tagging/.test(L)){ ch.type="scale100"; }
        else if(/coverage|%|adoption|frequency|rate|p95|median|mttr|lead time|time to|setup time/.test(L)){ ch.type="scale5"; }
      }
      if((ch.type==="scale5" || ch.type==="scale100") && !ch.scaleRef){
        ch.scaleRef = (ch.type==="scale100") ? "generic_0_100" : "generic_0_5";
      }
      if((ch.type==="scale5" || ch.type==="scale100") && !ch.purpose){
        const sc = SCALE_CATALOG[ch.scaleRef]; if(sc) ch.purpose = sc.purpose;
      }
    });
  }
}
patchModel();

/* ---------- State & view ---------- */
const STORAGE_KEYS = { core:"oemm_core24_seq", full:"oemm_full12_seq" };
let currentModule="core", currentView="pillar";
const formArea = document.getElementById("formArea");
function b64(s){ return btoa(unescape(encodeURIComponent(s))).replace(/=+$/,''); }
function fmt(n,d=1){ return (n==null||isNaN(n)) ? "—" : (+n).toFixed(d); }
function indexToScale(idx){
  if(idx==null||isNaN(idx)) return null;
  if(idx<=25) return 1 + (idx/25);
  if(idx<=50) return 2 + ((idx-25)/25);
  if(idx<=80) return 3 + ((idx-50)/30);
  return 4 + ((idx-80)/20);
}
function band(scale){
  if(scale==null) return "—";
  if(scale<2) return "Level 1 – Traditional";
  if(scale<2.5) return "Level 2 – Emerging";
  if(scale<=3) return "Level 3 – Agile max";
  if(scale<=4) return "Level 4 – Outcome oriented";
  return "Level 5 – Outcome engineered";
}
function getSaved(){ return JSON.parse(localStorage.getItem(STORAGE_KEYS[currentModule]) || "{}"); }
function setSaved(S){ localStorage.setItem(STORAGE_KEYS[currentModule], JSON.stringify(S)); }

/* ---------- Render ---------- */
function render(){
  formArea.innerHTML="";
  if(currentView==="pillar") renderByPillar(); else renderByTier();
  attachHandlers();
  compute();
}
function visibleParamIds(){
  const all = MODEL.fullModel.pillars.flatMap(p=>p.parameters);
  if(currentModule==="core"){ const set=new Set(MODEL.core24); return all.filter(id=>set.has(id)); }
  return all;
}
function renderByPillar(){
  const vis = new Set(visibleParamIds());
  MODEL.fullModel.pillars.forEach(block=>{
    const params = block.parameters.filter(p=>vis.has(p));
    if(!params.length) return;
    const card = document.createElement("div");
    card.className="pillar-card";
    card.innerHTML = `
      <header style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:8px;align-items:baseline">
          <h3 class="h3">${block.name}</h3>
          <span class="pill">Weight: ${MODEL.weights[block.name]}</span>
        </div>
        <span class="tiny">${params.length} items</span>
      </header>
      <div></div>`;
    const inner = card.lastElementChild;
    params.forEach(pid=> inner.appendChild(renderParam(block.name,pid)));
    formArea.appendChild(card);
  });
}
function renderByTier(){
  const vis = new Set(visibleParamIds());
  const tiers = {};
  vis.forEach(pid=>{ const t=PARAM_META[pid]?.tier||6; (tiers[t]=tiers[t]||[]).push(pid); });
  Object.keys(tiers).sort((a,b)=>a-b).forEach(t=>{
    const ids = tiers[t];
    const card = document.createElement("div");
    card.className="pillar-card";
    card.innerHTML = `
      <header style="display:flex;justify-content:space-between;align-items:center">
        <div class="titleWrap">
          <h3 class="h3">Tier ${t}</h3>
          <span class="tierTag">Low→High sequence</span>
        </div>
        <span class="tiny">${ids.length} items</span>
      </header>
      <div></div>`;
    const inner = card.lastElementChild;
    ids.forEach(pid=>{
      const pill = MODEL.fullModel.pillars.find(p=>p.parameters.includes(pid))?.name || "—";
      inner.appendChild(renderParam(pill,pid,true));
    });
    formArea.appendChild(card);
  });
}
function renderParam(pillarName, pid, showPillarChip=false){
  const def = MODEL.fullModel.parameters[pid];
  const meta = PARAM_META[pid] || {};
  const key = b64(pid);
  const wrap = document.createElement("div");
  wrap.className="item";
  wrap.innerHTML = `
    <header>
      <div class="titleWrap">
        ${meta.popular?'<span class="ico star" title="Popular ★" data-pop="'+pid+'">★</span>':''}
        <div style="font-weight:700">${def.label}</div>
        ${showPillarChip?`<span class="pill">${pillarName}</span>`:""}
        <span class="tierTag">Tier ${meta.tier||"—"}</span>
        <div class="icons">
          ${ (meta.dependsOn && meta.dependsOn.length) ? `<span class="ico chain" title="Dependencies" data-dep="${pid}">⛓️</span>` : "" }
          <span class="ico info" title="Details" data-info="${pid}">ⓘ</span>
        </div>
      </div>
      <span class="score-badge" id="badge-${key}">—</span>
    </header>
    <div class="tiny" style="margin-top:2px"><code style="font-family:var(--font-mono);font-size:.75rem;color:#0369a1">${pid}</code></div>
    <div class="progress" style="margin:8px 0"><div id="bar-${key}" class="bar" style="width:0%"></div></div>
    <div class="tiny" id="meta-${key}">Compliance: —% • Index: — • Scale: —</div>
    <div class="checks" id="checks-${key}"></div>
  `;
  const area = wrap.querySelector(`#checks-${key}`);
  const saved = getSaved()[pid] || {};
  def.checks.forEach((ch,i)=>{
    const row = document.createElement("div"); row.className="row";
    const type = ch.type || "check";
    const w = (typeof ch.w==="number")? ch.w : 0;
    const inputId = `${key}-${i}`;
    let control="";
    if(type==="check"){
      control = `
        <div class="field" style="min-width:320px">
          <label for="${inputId}">${ch.label}</label>
          <div class="row" style="align-items:center;gap:8px">
            <input id="${inputId}" type="checkbox" data-type="check" data-param="${pid}" data-index="${i}" />
            <span class="chip">Yes/No</span>
          </div>
        </div>`;
    } else if(type==="scale5"){
      const val = saved[i]?.v ?? 0;
      control = `
        <div class="field">
          <label for="${inputId}">${ch.label}</label>
          <div class="row" style="align-items:center;gap:8px">
            <input id="${inputId}" type="range" min="0" max="5" step="0.5" value="${val}" data-type="scale5" data-param="${pid}" data-index="${i}" aria-describedby="${inputId}-desc"/>
            <span class="chip">0–5</span>
            <button class="ico info" title="Scale info" data-scale="${ch.scaleRef||''}" data-scale-owner="${pid}" data-scale-idx="${i}">ⓘ</button>
          </div>
          <div id="${inputId}-desc" class="tiny">${ch.purpose||""}</div>
        </div>`;
    } else {
      const val = saved[i]?.v ?? 0;
      control = `
        <div class="field">
          <label for="${inputId}">${ch.label}</label>
          <div class="row" style="align-items:center;gap:8px">
            <input id="${inputId}" type="range" min="0" max="100" step="5" value="${val}" data-type="scale100" data-param="${pid}" data-index="${i}" aria-describedby="${inputId}-desc"/>
            <span class="chip">0–100%</span>
            <button class="ico info" title="Scale info" data-scale="${ch.scaleRef||''}" data-scale-owner="${pid}" data-scale-idx="${i}">ⓘ</button>
          </div>
          <div id="${inputId}-desc" class="tiny">${ch.purpose||""}</div>
        </div>`;
    }
    row.innerHTML = `
      <div style="flex:1">${control}</div>
      <span class="chip">w: ${w}%</span>
      <label class="na"><input type="checkbox" data-na="1" data-param="${pid}" data-index="${i}"/> N/A</label>
    `;
    area.appendChild(row);

    const ctrl = row.querySelector(`#${CSS.escape(inputId)}`);
    if(saved[i]){
      if((ctrl?.dataset.type)==="check") ctrl.checked = !!saved[i].v;
      else if(ctrl) ctrl.value = saved[i].v;
      const na = row.querySelector(`[data-na="1"]`);
      if(saved[i].na){ na.checked = true; if(ctrl) ctrl.disabled = true; }
    }
  });
  return wrap;
}

/* ---------- Popovers ---------- */
const overlay = document.getElementById("overlay");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
document.getElementById("modalClose").addEventListener("click", ()=> overlay.style.display="none");
overlay.addEventListener("click", e=>{ if(e.target===overlay) overlay.style.display="none"; });

function openModal(title, html){ modalTitle.textContent = title; modalContent.innerHTML = html; overlay.style.display="flex"; }
function paramInfoHTML(pid){
  const def = MODEL.fullModel.parameters[pid]; const meta = PARAM_META[pid] || {};
  const scaleItems = def.checks.map((ch,i)=>({ch,i})).filter(x=> x.ch.type==="scale5" || x.ch.ch